<button id="loginBtn">Spotifyでログイン</button>
<div id="result"></div>

<script>
const clientId = "377a8707077a4ac884a8bc0e89872715";
const redirectUri = "https://sitest.app.n8n.cloud/webhook/e9a32b6f-6b59-4403-8a8b-42cb6c5b0fb9";
//const redirectUri = "https://sitest.app.n8n.cloud/webhook-test/e9a32b6f-6b59-4403-8a8b-42cb6c5b0fb9";
const scopes = [
  "user-read-recently-played",
  "user-read-email",
  "user-top-read" 
];

document.getElementById("loginBtn").addEventListener("click", () => {
  const authUrl = `https://accounts.spotify.com/authorize?` + new URLSearchParams({
    client_id: clientId,
    response_type: "code",
    redirect_uri: redirectUri,
    scope: scopes.join(" "),
  });
  window.location.href = authUrl;
});

// 認証後に戻ってきた場合の処理
const urlParams = new URLSearchParams(window.location.search);
if (urlParams.has("user_id")) {
  const userId = urlParams.get("user_id");
  fetch(`https://your-n8n.app/webhook/get-analysis?user_id=${userId}`)
    .then(res => res.json())
    .then(data => {
      document.getElementById("result").innerText = JSON.stringify(data, null, 2);
    });
}
</script>
